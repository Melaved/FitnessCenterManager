<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>üë• {{.Title}}</h1>
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClientModal">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
</div>

<!-- –ü–æ–∏—Å–∫ -->
<form id="clientsSearchForm" class="input-group mb-3" method="get">
  <input type="search" class="form-control" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ ID" value="{{index .Filter "q"}}">
  <input type="hidden" name="medical" value="{{if index .Filter "medical"}}1{{end}}">
  <input type="hidden" name="recent" value="{{if index .Filter "recent"}}1{{end}}">
  <button class="btn btn-outline-primary" type="submit">–ù–∞–π—Ç–∏</button>
  {{if index .Filter "q"}}<a class="btn btn-outline-secondary" href="/clients">–°–±—Ä–æ—Å</a>{{end}}
</form>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="card mb-4">
  <div class="card-header"><h5 class="card-title mb-0">üîç –§–∏–ª—å—Ç—Ä—ã</h5></div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="filterMedicalData" {{if index .Filter "medical"}}checked{{end}}>
          <label class="form-check-label" for="filterMedicalData">üìã –¢–æ–ª—å–∫–æ —Å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</label>
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="filterRecentClients" {{if index .Filter "recent"}}checked{{end}}>
          <label class="form-check-label" for="filterRecentClients">üÜï –ö–ª–∏–µ–Ω—Ç—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</label>
        </div>
      </div>
    </div>
    <div class="mt-3 d-flex gap-2">
      <button class="btn btn-outline-primary btn-sm" id="applyClientsFiltersBtn" type="button">‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      <a class="btn btn-outline-secondary btn-sm" href="/clients">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å</a>
      <span class="badge bg-info ms-2" id="filterStatus">
        {{if index .Filter "q"}}–ü–æ–∏—Å–∫: ¬´{{index .Filter "q"}}¬ª; {{end}}
        {{if index .Filter "medical"}}–ú–µ–¥. –¥–∞–Ω–Ω—ã–µ; {{end}}
        {{if index .Filter "recent"}}–ó–∞ 30 –¥–Ω–µ–π; {{end}}
        {{if not (or (index .Filter "q") (index .Filter "medical") (index .Filter "recent"))}}–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã{{end}}
      </span>
    </div>
  </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ -->
<div class="card">
  <div class="card-header"><h5 class="card-title mb-0">–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤</h5></div>
  <div class="card-body">
    {{if .Clients}}
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>–§–ò–û</th>
            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th>–í–æ–∑—Ä–∞—Å—Ç</th>              <!-- NEW -->
            <th>–ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</th>           <!-- NEW -->
            <th>–ê–∫—Ç–∏–≤–Ω—ã–π</th>             <!-- NEW -->
            <th>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</th>
            <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
            <th>–ú–µ–¥. –¥–∞–Ω–Ω—ã–µ</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {{range .Clients}}
          <tr>
            <td>{{.ID}}</td>
            <td>{{.FIO}}</td>
            <td>{{.Phone}}</td>
            <td>{{.Age}}</td>
            <td>{{.SubscriptionsCnt}}</td>
            <td>
              {{if eq .ActiveStatus "–ê–∫—Ç–∏–≤–µ–Ω"}}
                <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
              {{else}}
                <span class="badge bg-secondary">–ù–µ—Ç</span>
              {{end}}
            </td>
            <td>{{.BirthDate.Format "02.01.2006"}}</td>
            <td>{{.RegisterDate.Format "02.01.2006"}}</td>
            <td>
              {{if .MedicalData.Valid}}
                {{if ne .MedicalData.String ""}}<span class="badge bg-info">–ï—Å—Ç—å</span>{{else}}<span class="badge bg-secondary">–ù–µ—Ç</span>{{end}}
              {{else}}<span class="badge bg-secondary">–ù–µ—Ç</span>{{end}}
            </td>
            <td class="text-nowrap">
              <button class="btn btn-sm btn-outline-primary edit-client-btn" data-client-id="{{.ID}}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞">‚úèÔ∏è</button>
              <button class="btn btn-sm btn-outline-danger delete-client-btn" data-client-id="{{.ID}}" data-client-name="{{.FIO}}" title="–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞">üóëÔ∏è</button>
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
    {{else}}
    <div class="alert alert-info"><h5>–ö–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h5><p>–ù–∞–∂–º–∏—Ç–µ ¬´–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞¬ª, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ</p></div>
    {{end}}
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞: –¥–æ–±–∞–≤–∏—Ç—å -->
<div class="modal fade" id="addClientModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <form id="addClientForm">
      <div class="modal-body">
        <div class="mb-3"><label class="form-label">–§–ò–û *</label><input type="text" class="form-control" name="fio" required></div>
        <div class="mb-3">
          <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
          <input type="tel" class="form-control" name="phone" pattern="\+7[0-9]{10}" placeholder="+79161234567" required>
          <div class="form-text">–§–æ—Ä–º–∞—Ç: +7XXXXXXXXXX</div>
        </div>
        <div class="mb-3"><label class="form-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è *</label><input type="date" class="form-control" name="birth_date" required></div>
        <div class="mb-3"><label class="form-label">–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</label><textarea class="form-control" name="medical_data" rows="3" placeholder="–ê–ª–ª–µ—Ä–≥–∏–∏, —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è..."></textarea></div>
      </div>
      <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button><button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div>
    </form>
  </div></div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
<div class="modal fade" id="editClientModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <form id="editClientForm">
      <input type="hidden" id="editClientId" name="id">
      <div class="modal-body">
        <div class="mb-3"><label class="form-label">–§–ò–û *</label><input type="text" class="form-control" id="editFio" name="fio" required></div>
        <div class="mb-3">
          <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
          <input type="tel" class="form-control" id="editPhone" name="phone" pattern="\+7[0-9]{10}" placeholder="+79161234567" required>
          <div class="form-text">–§–æ—Ä–º–∞—Ç: +7XXXXXXXXXX</div>
        </div>
        <div class="mb-3"><label class="form-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è *</label><input type="date" class="form-control" id="editBirthDate" name="birth_date" required></div>
        <div class="mb-3"><label class="form-label">–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</label><textarea class="form-control" id="editMedicalData" name="medical_data" rows="3"></textarea></div>
      </div>
      <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button><button type="submit" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å</button></div>
    </form>
  </div></div>
</div>
