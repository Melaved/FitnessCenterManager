<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">üèãÔ∏è –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="/">üìä –ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/clients">üë• –ö–ª–∏–µ–Ω—Ç—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/trainers">üèÉ –¢—Ä–µ–Ω–µ—Ä—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/subscriptions">üé´ –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/trainings">üìÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about">‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>üë• {{.Title}}</h1>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClientModal">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
            </button>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤</h5>
            </div>
            <div class="card-body">
                {{if .Clients}}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>–§–ò–û</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</th>
                                <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                <th>–ú–µ–¥. –¥–∞–Ω–Ω—ã–µ</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range .Clients}}
                            <tr>
                                <td>{{.ID}}</td>
                                <td>{{.FIO}}</td>
                                <td>{{.Phone}}</td>
                                <td>{{.BirthDate.Format "02.01.2006"}}</td>
                                <td>{{.RegisterDate.Format "02.01.2006"}}</td>
                                <td>
                                    {{if .MedicalData.Valid}}
                                        <span class="badge bg-info">–ï—Å—Ç—å</span>
                                    {{else}}
                                        <span class="badge bg-secondary">–ù–µ—Ç</span>
                                    {{end}}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å">
                                        üóëÔ∏è
                                    </button>
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
                {{else}}
                <div class="alert alert-info">
                    <h5>–ö–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h5>
                    <p>–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞" —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</p>
                </div>
                {{end}}
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div class="modal fade" id="addClientModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addClientForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">–§–ò–û *</label>
                            <input type="text" class="form-control" name="fio" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                            <input type="tel" class="form-control" name="phone" pattern="\+7[0-9]{10}" 
                                placeholder="+79161234567" required>
                            <div class="form-text">–§–æ—Ä–º–∞—Ç: +7XXXXXXXXXX</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è *</label>
                            <input type="date" class="form-control" name="birth_date" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</label>
                            <textarea class="form-control" name="medical_data" rows="3" 
                                    placeholder="–ê–ª–ª–µ—Ä–≥–∏–∏, —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-light mt-5 py-3">
        <div class="container text-center">
            <small>–§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä &copy; 2025</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('addClientForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const submitBtn = this.querySelector('button[type="submit"]');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚åõ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            
            try {
                const response = await fetch('/clients', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    this.reset();
                    
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addClientModal'));
                    modal.hide();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                    setTimeout(() => location.reload(), 1000);
                } else {
                    alert('‚ùå ' + result.error);
                }
                
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            }
        });
    </script>
</body>
</html>