<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">üèãÔ∏è –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="/">üìä –ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/clients">üë• –ö–ª–∏–µ–Ω—Ç—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/trainers">üèÉ –¢—Ä–µ–Ω–µ—Ä—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/subscriptions">üé´ –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/trainings">üìÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a></li>
                    <li class="nav-item"><a class="nav-link" href="/zones">üèüÔ∏è –ó–æ–Ω—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about">‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container mt-4">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>üë• {{.Title}}</h1>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClientModal">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
            </button>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ - –ü–ï–†–ï–î —Ç–∞–±–ª–∏—Ü–µ–π -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">üîç –§–∏–ª—å—Ç—Ä—ã</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filterMedicalData">
                            <label class="form-check-label" for="filterMedicalData">
                                üìã –¢–æ–ª—å–∫–æ —Å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="filterRecentClients">
                            <label class="form-check-label" for="filterRecentClients">
                                üÜï –ö–ª–∏–µ–Ω—Ç—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
                            </label>
                        </div>
                    </div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ -->
                <div class="mt-3">
                    <button class="btn btn-outline-primary btn-sm" onclick="applyFilters()">
                        ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="clearFilters()">
                        üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </button>
                    <span class="badge bg-info ms-2" id="filterStatus">
                        –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã
                    </span>
                </div>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤</h5>
            </div>
            <div class="card-body">
                {{if .Clients}}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>–§–ò–û</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</th>
                                <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                <th>–ú–µ–¥. –¥–∞–Ω–Ω—ã–µ</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range .Clients}}
                            <tr>
                                <td>{{.ID}}</td>
                                <td>{{.FIO}}</td>
                                <td>{{.Phone}}</td>
                                <td>{{.BirthDate.Format "02.01.2006"}}</td>
                                <td>{{.RegisterDate.Format "02.01.2006"}}</td>
                                <td>
                                    {{if .MedicalData.Valid}}
                                    {{if ne .MedicalData.String ""}}
                                    <span class="badge bg-info">–ï—Å—Ç—å</span>
                                    {{else}}
                                    <span class="badge bg-secondary">–ù–µ—Ç</span>
                                    {{end}}
                                    {{else}}
                                    <span class="badge bg-secondary">–ù–µ—Ç</span>
                                    {{end}}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary edit-client-btn"
                                        data-client-id="{{.ID}}" data-bs-toggle="tooltip" data-bs-placement="top"
                                        title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger delete-client-btn"
                                        data-client-id="{{.ID}}" data-client-name="{{.FIO}}" data-bs-toggle="tooltip"
                                        data-bs-placement="top" title="–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞">
                                        üóëÔ∏è
                                    </button>
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
                {{else}}
                <div class="alert alert-info">
                    <h5>–ö–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h5>
                    <p>–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞" —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</p>
                </div>
                {{end}}
            </div>
        </div>
    </div>



    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div class="modal fade" id="addClientModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addClientForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">–§–ò–û *</label>
                            <input type="text" class="form-control" name="fio" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                            <input type="tel" class="form-control" name="phone" pattern="\+7[0-9]{10}"
                                placeholder="+79161234567" required>
                            <div class="form-text">–§–æ—Ä–º–∞—Ç: +7XXXXXXXXXX</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è *</label>
                            <input type="date" class="form-control" name="birth_date" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</label>
                            <textarea class="form-control" name="medical_data" rows="3"
                                placeholder="–ê–ª–ª–µ—Ä–≥–∏–∏, —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div class="modal fade" id="editClientModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="editClientForm">
                    <input type="hidden" id="editClientId" name="id">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">–§–ò–û *</label>
                            <input type="text" class="form-control" id="editFio" name="fio" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                            <input type="tel" class="form-control" id="editPhone" name="phone" pattern="\+7[0-9]{10}"
                                placeholder="+79161234567" required>
                            <div class="form-text">–§–æ—Ä–º–∞—Ç: +7XXXXXXXXXX</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è *</label>
                            <input type="date" class="form-control" id="editBirthDate" name="birth_date" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</label>
                            <textarea class="form-control" id="editMedicalData" name="medical_data" rows="3"
                                placeholder="–ê–ª–ª–µ—Ä–≥–∏–∏, —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-light mt-5 py-3">
        <div class="container text-center">
            <small>–§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä &copy; 2025</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function () {
            console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            updateFilterStatus();

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            initializeEditButtons();
        });

        // ==================== –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ö–õ–ò–ï–ù–¢–û–í ====================

        function initializeEditButtons() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.querySelectorAll('.edit-client-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const clientId = this.getAttribute('data-client-id');
                    console.log('üéØ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ ID:', clientId);
                    loadClientForEditing(clientId);
                });
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        async function loadClientForEditing(clientId) {
            try {
                console.log('üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ ID:', clientId);

                const response = await fetch(`/clients/${clientId}`);
                const result = await response.json();

                if (result.success) {
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', result.client);
                    populateEditForm(result.client);

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    const editModal = new bootstrap.Modal(document.getElementById('editClientModal'));
                    editModal.show();
                } else {
                    alert('‚ùå ' + result.error);
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞: ' + error.message);
            }
        }

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞
        function populateEditForm(client) {
            document.getElementById('editClientId').value = client.id;
            document.getElementById('editFio').value = client.fio;
            document.getElementById('editPhone').value = client.phone;
            document.getElementById('editBirthDate').value = client.birth_date;
            document.getElementById('editMedicalData').value = client.medical_data || '';

            console.log('üìù –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        document.getElementById('editClientForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const clientId = document.getElementById('editClientId').value;
            const formData = new FormData(this);
            const submitBtn = this.querySelector('button[type="submit"]');

            console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ ID:', clientId);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚åõ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';

            try {
                const response = await fetch(`/clients/${clientId}`, {
                    method: 'PUT',
                    body: formData
                });

                const result = await response.json();
                console.log('üì• –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:', result);

                if (result.success) {
                    alert('‚úÖ ' + result.message);

                    const modal = bootstrap.Modal.getInstance(document.getElementById('editClientModal'));
                    modal.hide();

                    // –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                    await loadClientsData();
                } else {
                    alert('‚ùå ' + result.error);
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '–û–±–Ω–æ–≤–∏—Ç—å';
            }
        });

        // ==================== –î–û–ë–ê–í–õ–ï–ù–ò–ï –ö–õ–ò–ï–ù–¢–û–í ====================

        document.getElementById('addClientForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const submitBtn = this.querySelector('button[type="submit"]');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚åõ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';

            try {
                const response = await fetch('/clients', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                console.log('üì• –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏:', result);

                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    this.reset();

                    const modal = bootstrap.Modal.getInstance(document.getElementById('addClientModal'));
                    modal.hide();

                    // –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                    await loadClientsData();
                } else {
                    alert('‚ùå ' + result.error);
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            }
        });


        // ==================== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø ====================

        let currentFilters = {
            medicalData: false,
            recentClients: false
        };

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            console.log('üéØ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤...');

            // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ CheckBox'–æ–≤
            currentFilters.medicalData = document.getElementById('filterMedicalData').checked;
            currentFilters.recentClients = document.getElementById('filterRecentClients').checked;

            console.log('üìä –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:', currentFilters);

            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É
            filterTable();

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            updateFilterStatus();
        }

        // –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã
        function filterTable() {
            const rows = document.querySelectorAll('table tbody tr');
            let visibleCount = 0;

            rows.forEach(row => {
                let showRow = true;

                // –§–∏–ª—å—Ç—Ä –ø–æ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º
                if (currentFilters.medicalData) {
                    const medicalBadge = row.querySelector('td:nth-child(6) .badge');
                    if (medicalBadge && medicalBadge.textContent === '–ù–µ—Ç') {
                        showRow = false;
                    }
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ –Ω–æ–≤—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
                if (currentFilters.recentClients) {
                    const registerDateText = row.querySelector('td:nth-child(5)').textContent;
                    const registerDate = parseDate(registerDateText);
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

                    if (registerDate < thirtyDaysAgo) {
                        showRow = false;
                    }
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É
                row.style.display = showRow ? '' : 'none';
                if (showRow) visibleCount++;
            });

            console.log(`‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–æ ${visibleCount} –∏–∑ ${rows.length} –∫–ª–∏–µ–Ω—Ç–æ–≤`);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            showNoResultsMessage(visibleCount === 0);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ "dd.mm.yyyy"
        function parseDate(dateString) {
            const parts = dateString.split('.');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function clearFilters() {
            console.log('üîÑ –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤...');

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º CheckBox
            document.getElementById('filterMedicalData').checked = false;
            document.getElementById('filterRecentClients').checked = false;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            currentFilters.medicalData = false;
            currentFilters.recentClients = false;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏
            const rows = document.querySelectorAll('table tbody tr');
            rows.forEach(row => row.style.display = '');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            updateFilterStatus();

            // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"
            showNoResultsMessage(false);

            console.log('‚úÖ –§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã');
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function updateFilterStatus() {
            const statusElement = document.getElementById('filterStatus');
            let statusText = '–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã';

            if (currentFilters.medicalData && currentFilters.recentClients) {
                statusText = '–° –º–µ–¥. –¥–∞–Ω–Ω—ã–º–∏ + –Ω–æ–≤—ã–µ';
            } else if (currentFilters.medicalData) {
                statusText = '–¢–æ–ª—å–∫–æ —Å –º–µ–¥. –¥–∞–Ω–Ω—ã–º–∏';
            } else if (currentFilters.recentClients) {
                statusText = '–¢–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã';
            }

            statusElement.textContent = statusText;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è "–Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"
        function showNoResultsMessage(show) {
            let noResultsMsg = document.getElementById('noResultsMessage');

            if (show && !noResultsMsg) {
                noResultsMsg = document.createElement('div');
                noResultsMsg.id = 'noResultsMessage';
                noResultsMsg.className = 'alert alert-warning mt-3';
                noResultsMsg.innerHTML = `
                    <h5>ü§∑‚Äç‚ôÇÔ∏è –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
                    <button class="btn btn-sm btn-outline-secondary" onclick="clearFilters()">
                        –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </button>
                `;

                const tableCard = document.querySelector('.card');
                tableCard.parentNode.insertBefore(noResultsMsg, tableCard.nextSibling);
            } else if (!show && noResultsMsg) {
                noResultsMsg.remove();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
        async function loadClientsData() {
            console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤...');

            try {
                const response = await fetch('/clients');
                const html = await response.text();

                // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;

                // –ù–∞—Ö–æ–¥–∏–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –Ω–æ–≤–æ–º HTML
                const newTableBody = tempDiv.querySelector('table tbody');
                const currentTableBody = document.querySelector('table tbody');

                if (newTableBody && currentTableBody) {
                    // –ó–∞–º–µ–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–ª–∏—Ü—ã
                    currentTableBody.innerHTML = newTableBody.innerHTML;
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');

                    // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    initializeEditButtons();

                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                    clearFilters();
                } else {
                    // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É');
                    location.reload();
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                // –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                location.reload();
            }
        }
        // ==================== –£–î–ê–õ–ï–ù–ò–ï –ö–õ–ò–ï–ù–¢–û–í ====================

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
        function initializeDeleteButtons() {
            document.querySelectorAll('.delete-client-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const clientId = this.getAttribute('data-client-id');
                    const clientName = this.getAttribute('data-client-name');
                    confirmDeleteClient(clientId, clientName);
                });
            });
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        function confirmDeleteClient(clientId, clientName) {
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ "${clientName}"?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`)) {
                deleteClient(clientId, clientName);
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        async function deleteClient(clientId, clientName) {
            console.log('üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ ID:', clientId);

            try {
                const response = await fetch(`/clients/${clientId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                console.log('üì• –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:', result);

                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    await loadClientsData();
                } else {
                    alert('‚ùå ' + result.error);
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message);
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', function () {
            console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            updateFilterStatus();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è
            initializeEditButtons();
            initializeDeleteButtons();  // ‚úÖ –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –°–¢–†–û–ö–£
        });

        // –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é loadClientsData –¥–ª—è –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫
        async function loadClientsData() {
            console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤...');

            try {
                const response = await fetch('/clients');
                const html = await response.text();

                // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;

                // –ù–∞—Ö–æ–¥–∏–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –Ω–æ–≤–æ–º HTML
                const newTableBody = tempDiv.querySelector('table tbody');
                const currentTableBody = document.querySelector('table tbody');

                if (newTableBody && currentTableBody) {
                    // –ó–∞–º–µ–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–ª–∏—Ü—ã
                    currentTableBody.innerHTML = newTableBody.innerHTML;
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');

                    // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –í–°–ï –∫–Ω–æ–ø–∫–∏
                    initializeEditButtons();
                    initializeDeleteButtons();

                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                    clearFilters();
                } else {
                    // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É');
                    location.reload();
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                location.reload();
            }
        }
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ CheckBox'–æ–≤
    </script>
</body>

</html>