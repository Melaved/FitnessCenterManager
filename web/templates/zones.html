<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{.Title}} - –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    .photo-preview { max-width: 200px; max-height: 150px; border-radius: 8px; cursor: pointer; transition: transform .2s; }
    .photo-preview:hover { transform: scale(1.05); }
    .zone-card { transition: all .3s ease; }
    .zone-card:hover { box-shadow: 0 8px 25px rgba(0,0,0,.15); transform: translateY(-2px); }
    .no-photo-placeholder { height: 150px; background: linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%); border: 2px dashed #dee2e6; border-radius: 8px; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="/">üèãÔ∏è –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="/">üìä –ì–ª–∞–≤–Ω–∞—è</a></li>
          <li class="nav-item"><a class="nav-link" href="/clients">üë• –ö–ª–∏–µ–Ω—Ç—ã</a></li>
          <li class="nav-item"><a class="nav-link" href="/trainers">üèÉ –¢—Ä–µ–Ω–µ—Ä—ã</a></li>
          <li class="nav-item"><a class="nav-link" href="/subscriptions">üé´ –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</a></li>
          <li class="nav-item"><a class="nav-link" href="/trainings">üìÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a></li>
          <li class="nav-item"><a class="nav-link active" href="/zones">üèüÔ∏è –ó–æ–Ω—ã</a></li>
          <li class="nav-item"><a class="nav-link" href="/about">‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="mb-0">üèüÔ∏è {{.Title}}</h1>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addZoneModal" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–æ–Ω—É">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—É
      </button>
    </div>

    <!-- –°–µ—Ç–∫–∞ –∑–æ–Ω -->
    <div class="row">
      {{range .Zones}}
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="card zone-card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">{{.Name}}</h5>
          </div>
          <div class="card-body">
            <!-- –§–æ—Ç–æ –∑–æ–Ω—ã -->
            <div class="text-center mb-3">
              {{if .HasPhoto}}
                <img src="/zones/{{.ID}}/photo" class="photo-preview img-thumbnail" alt="–§–æ—Ç–æ {{.Name}}" loading="lazy" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞">
              {{else}}
                <div class="no-photo-placeholder d-flex align-items-center justify-content-center" title="–§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ">
                  <span class="text-muted">üì∑ –ù–µ—Ç —Ñ–æ—Ç–æ</span>
                </div>
              {{end}}
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–æ–Ω–µ -->
            <p class="card-text mb-2">{{.Description}}</p>
            <ul class="list-group list-group-flush">
              <li class="list-group-item d-flex justify-content-between">
                <span>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:</span>
                <span class="badge bg-primary">{{.Capacity}} —á–µ–ª.</span>
              </li>
              <li class="list-group-item d-flex justify-content-between">
                <span>–°—Ç–∞—Ç—É—Å:</span>
                <span class="badge
                  {{- if eq .Status "–î–æ—Å—Ç—É–ø–Ω–∞" -}} bg-success
                  {{- else if eq .Status "–ù–∞ —Ä–µ–º–æ–Ω—Ç–µ" -}} bg-warning
                  {{- else if eq .Status "–ó–∞–∫—Ä—ã—Ç–∞" -}} bg-secondary
                  {{- else -}} bg-danger {{- end -}}">
                  {{.Status}}
                </span>
              </li>
            </ul>
          </div>
          <div class="card-footer">
            <div class="btn-group w-100">
              <!-- –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ -->
              <button class="btn btn-outline-success btn-sm"
                      data-bs-toggle="modal"
                      data-bs-target="#uploadPhotoModal"
                      data-zone-id="{{.ID}}"
                      data-zone-name="{{.Name}}"
                      title="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –¥–ª—è —ç—Ç–æ–π –∑–æ–Ω—ã">
                üì∑ –§–æ—Ç–æ
              </button>

              <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
              <button class="btn btn-outline-primary btn-sm edit-zone-btn"
                      data-zone-id="{{.ID}}"
                      title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–µ">
                ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å
              </button>

              <!-- –£–¥–∞–ª–∏—Ç—å -->
              <button class="btn btn-outline-danger btn-sm delete-zone-btn"
                      data-zone-id="{{.ID}}"
                      data-zone-name="{{.Name}}"
                      title="–£–¥–∞–ª–∏—Ç—å –∑–æ–Ω—É">
                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
              </button>
            </div>
          </div>
        </div>
      </div>
      {{else}}
      <div class="col-12">
        <div class="alert alert-info text-center">
          <h5 class="mb-1">üèüÔ∏è –ó–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h5>
          <p class="mb-0">–ù–∞–∂–º–∏—Ç–µ ¬´–î–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—É¬ª, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é</p>
        </div>
      </div>
      {{end}}
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –¥–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—É -->
  <div class="modal fade" id="addZoneModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—É</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="addZoneForm">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–æ–Ω—ã *</label>
            <input type="text" class="form-control" name="name" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞—Ä–¥–∏–æ-–∑–æ–Ω–∞"/>
          </div>
          <div class="mb-3">
            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea class="form-control" name="description" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–æ–Ω—ã –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è..."></textarea>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å *</label>
                <input type="number" class="form-control" name="capacity" min="1" max="100" value="10" required/>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">–°—Ç–∞—Ç—É—Å *</label>
                <select class="form-select" name="status" required>
                  <option value="–î–æ—Å—Ç—É–ø–Ω–∞" selected>–î–æ—Å—Ç—É–ø–Ω–∞</option>
                  <option value="–ù–∞ —Ä–µ–º–æ–Ω—Ç–µ">–ù–∞ —Ä–µ–º–æ–Ω—Ç–µ</option>
                  <option value="–ó–∞–∫—Ä—ã—Ç–∞">–ó–∞–∫—Ä—ã—Ç–∞</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </form>
    </div></div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ -->
  <div class="modal fade" id="uploadPhotoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –∑–æ–Ω—ã</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="uploadPhotoForm" enctype="multipart/form-data">
        <div class="modal-body">
          <input type="hidden" id="uploadZoneId" name="zone_id"/>
          <div class="mb-3">
            <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ</label>
            <input type="file" class="form-control" name="photo" accept="image/jpeg,image/png,image/webp" required/>
            <div class="form-text">–†–∞–∑—Ä–µ—à–µ–Ω—ã: JPEG, PNG, WebP. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 MB</div>
          </div>
          <div class="mb-3">
            <label>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</label>
            <div id="photoPreview" class="text-center mt-2">
              <img id="previewImage" class="img-thumbnail d-none" style="max-height: 200px;">
              <div id="noPreview" class="text-muted">üì∑ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" id="clearPhotoBtn" title="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ –∑–æ–Ω—ã">üßπ –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ç–æ</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-success">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>
        </div>
      </form>
    </div></div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
  <div class="modal fade" id="editZoneModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–æ–Ω—É</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="editZoneForm">
        <div class="modal-body">
          <input type="hidden" id="editZoneId" name="id"/>
          <div class="mb-3">
            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–æ–Ω—ã *</label>
            <input type="text" class="form-control" name="name" id="editName" required/>
          </div>
          <div class="mb-3">
            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea class="form-control" name="description" id="editDescription" rows="3"></textarea>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å *</label>
                <input type="number" class="form-control" name="capacity" id="editCapacity" min="1" max="100" required/>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">–°—Ç–∞—Ç—É—Å *</label>
                <select class="form-select" name="status" id="editStatus" required>
                  <option value="–î–æ—Å—Ç—É–ø–Ω–∞">–î–æ—Å—Ç—É–ø–Ω–∞</option>
                  <option value="–ù–∞ —Ä–µ–º–æ–Ω—Ç–µ">–ù–∞ —Ä–µ–º–æ–Ω—Ç–µ</option>
                  <option value="–ó–∞–∫—Ä—ã—Ç–∞">–ó–∞–∫—Ä—ã—Ç–∞</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </div>
      </form>
    </div></div>
  </div>

  <footer class="bg-dark text-light mt-5 py-3">
    <div class="container text-center">
      <small>–§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä &copy; 2025</small>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // –£—Ç–∏–ª–∏—Ç–∞: –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å JSON (–∞ –µ—Å–ª–∏ –ø—Ä–∏–ª–µ—Ç–∏—Ç HTML ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç)
    async function parseJsonOrThrow(response) {
      const ct = (response.headers.get('content-type') || '').toLowerCase();
      if (ct.includes('application/json')) return response.json();
      const text = await response.text();
      throw new Error(text.slice(0, 300) || '–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ-JSON');
    }

    document.addEventListener('DOMContentLoaded', () => {
      // tooltips
      [...document.querySelectorAll('[title]')].forEach(el => new bootstrap.Tooltip(el));

      // —É–¥–∞–ª–µ–Ω–∏–µ
      document.querySelectorAll('.delete-zone-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const id = btn.getAttribute('data-zone-id');
          const name = btn.getAttribute('data-zone-name');
          if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∑–æ–Ω—É ¬´${name}¬ª?`)) return;
          try {
            const resp = await fetch(`/zones/${id}`, { method: 'DELETE' });
            const res = await parseJsonOrThrow(resp);
            if (res.success) {
              alert('‚úÖ ' + (res.message || '–£–¥–∞–ª–µ–Ω–æ'));
              location.reload();
            } else {
              alert('‚ùå ' + (res.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å'));
            }
          } catch (e) {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + e.message);
          }
        });
      });

      // —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É –∏ –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
      document.querySelectorAll('.edit-zone-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const id = btn.getAttribute('data-zone-id');
          try {
            const resp = await fetch(`/api/zones/${id}`);
            const res = await parseJsonOrThrow(resp);
            if (!res.success) throw new Error(res.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∑–æ–Ω—É');

            const z = res.zone;
            document.getElementById('editZoneId').value = z.ID || z.id || id;
            document.getElementById('editName').value = z.Name || z.name || '';
            document.getElementById('editDescription').value = z.Description || z.description || '';
            document.getElementById('editCapacity').value = z.Capacity || z.capacity || 1;
            document.getElementById('editStatus').value = z.Status || z.status || '–î–æ—Å—Ç—É–ø–Ω–∞';

            new bootstrap.Modal(document.getElementById('editZoneModal')).show();
          } catch (e) {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + e.message);
          }
        });
      });

      // submit: –¥–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—É
      document.getElementById('addZoneForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.currentTarget;
        const btn = form.querySelector('button[type="submit"]');
        btn.disabled = true; btn.innerHTML = '‚åõ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
        try {
          const resp = await fetch('/zones', { method: 'POST', body: new FormData(form) });
          const res = await parseJsonOrThrow(resp);
          if (res.success) {
            alert('‚úÖ ' + (res.message || '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ'));
            bootstrap.Modal.getInstance(document.getElementById('addZoneModal')).hide();
            form.reset();
            setTimeout(() => location.reload(), 500);
          } else {
            alert('‚ùå ' + (res.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'));
          }
        } catch (e2) {
          alert('‚ùå –û—à–∏–±–∫–∞: ' + e2.message);
        } finally { btn.disabled = false; btn.innerHTML = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'; }
      });

      // –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ: –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –∏ —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–µ–≤—å—é
      document.getElementById('uploadPhotoModal').addEventListener('show.bs.modal', (ev) => {
        const btn = ev.relatedTarget;
        const id = btn.getAttribute('data-zone-id');
        const name = btn.getAttribute('data-zone-name');
        document.querySelector('#uploadPhotoModal .modal-title').textContent = `–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ: ${name}`;
        document.getElementById('uploadZoneId').value = id;
        document.getElementById('previewImage').classList.add('d-none');
        document.getElementById('noPreview').style.display = 'block';
        document.querySelector('#uploadPhotoForm input[name="photo"]').value = '';
      });

      // –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ
      document.querySelector('#uploadPhotoForm input[name="photo"]').addEventListener('change', (e) => {
        const file = e.target.files[0];
        const img = document.getElementById('previewImage');
        const noPrev = document.getElementById('noPreview');
        if (file) {
          const reader = new FileReader();
          reader.onload = ev2 => { img.src = ev2.target.result; img.classList.remove('d-none'); noPrev.style.display = 'none'; };
          reader.readAsDataURL(file);
        } else {
          img.classList.add('d-none'); noPrev.style.display = 'block';
        }
      });

      // submit: –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
      document.getElementById('uploadPhotoForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const zoneId = document.getElementById('uploadZoneId').value;
        const form = e.currentTarget;
        const btn = form.querySelector('button[type="submit"]');
        btn.disabled = true; btn.innerHTML = '‚åõ –ó–∞–≥—Ä—É–∑–∫–∞...';
        try {
          const resp = await fetch(`/zones/${zoneId}/upload-photo`, { method: 'POST', body: new FormData(form) });
          const res = await parseJsonOrThrow(resp);
          if (res.success) {
            alert('‚úÖ ' + (res.message || '–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ'));
            bootstrap.Modal.getInstance(document.getElementById('uploadPhotoModal')).hide();
            setTimeout(() => location.reload(), 500);
          } else {
            alert('‚ùå ' + (res.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å'));
          }
        } catch (e2) {
          alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + e2.message);
        } finally { btn.disabled = false; btn.innerHTML = 'üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ'; }
      });

      // –æ—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ç–æ (–§–æ—Ç–æ = NULL)
      document.getElementById('clearPhotoBtn').addEventListener('click', async () => {
        const zoneId = document.getElementById('uploadZoneId').value;
        if (!zoneId) return;
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∑–æ–Ω—ã?')) return;
        try {
          const resp = await fetch(`/zones/${zoneId}/photo`, { method: 'DELETE' });
          const res = await parseJsonOrThrow(resp);
          if (res.success) {
            alert('üßπ –§–æ—Ç–æ —É–¥–∞–ª–µ–Ω–æ');
            bootstrap.Modal.getInstance(document.getElementById('uploadPhotoModal')).hide();
            setTimeout(() => location.reload(), 500);
          } else {
            alert('‚ùå ' + (res.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ'));
          }
        } catch (e) {
          alert('‚ùå –û—à–∏–±–∫–∞: ' + e.message);
        }
      });

      // submit: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–æ–Ω—ã
      document.getElementById('editZoneForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.currentTarget;
        const id = document.getElementById('editZoneId').value;
        const btn = form.querySelector('button[type="submit"]');
        btn.disabled = true; btn.innerHTML = '‚åõ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';

        // –°–æ–±–∏—Ä–∞–µ–º —Ñ–æ—Ä–º—É –∫–∞–∫ x-www-form-urlencoded, Fiber —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø–∞—Ä—Å–∏—Ç
        const data = new URLSearchParams(new FormData(form));

        try {
          const resp = await fetch(`/zones/${id}`, { method: 'PUT', body: data });
          const res = await parseJsonOrThrow(resp);
          if (res.success) {
            alert('‚úÖ ' + (res.message || '–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã'));
            bootstrap.Modal.getInstance(document.getElementById('editZoneModal')).hide();
            setTimeout(() => location.reload(), 500);
          } else {
            alert('‚ùå ' + (res.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å'));
          }
        } catch (e2) {
          alert('‚ùå –û—à–∏–±–∫–∞: ' + e2.message);
        } finally { btn.disabled = false; btn.innerHTML = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è'; }
      });

      // –ó—É–º –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ—Ç–æ
      document.addEventListener('click', (e) => {
        if (!e.target.classList.contains('photo-preview')) return;
        const overlay = document.createElement('div');
        overlay.style.cssText = `
          position: fixed; inset: 0; background: rgba(0,0,0,.8);
          display:flex; justify-content:center; align-items:center; z-index: 9999; cursor: zoom-out;
        `;
        const img = document.createElement('img');
        img.src = e.target.src;
        img.style.cssText = 'max-width:90%; max-height:90%; border-radius:8px; box-shadow:0 0 30px rgba(0,0,0,.5);';
        overlay.appendChild(img);
        overlay.addEventListener('click', () => document.body.removeChild(overlay));
        document.body.appendChild(overlay);
      });
    });
  </script>
</body>
</html>
