<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .photo-preview {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .photo-preview:hover {
            transform: scale(1.05);
        }

        .zone-card {
            transition: all 0.3s ease;
        }

        .zone-card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .no-photo-placeholder {
            height: 150px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px dashed #dee2e6;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">üèãÔ∏è –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="/">üìä –ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li class="nav-item"><a class="nav-link" href="/clients">üë• –ö–ª–∏–µ–Ω—Ç—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/trainers">üèÉ –¢—Ä–µ–Ω–µ—Ä—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/subscriptions">üé´ –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/trainings">üìÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/zones">üèüÔ∏è –ó–æ–Ω—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about">‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>üèüÔ∏è {{.Title}}</h1>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addZoneModal"
                data-bs-toggle="tooltip" data-bs-placement="top" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–æ–Ω—É">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—É
            </button>
        </div>

        <!-- –°–µ—Ç–∫–∞ –∑–æ–Ω -->
        <div class="row">
            {{range .Zones}}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card zone-card h-100">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{.Name}}</h5>
                    </div>
                    <div class="card-body">
                        <!-- –§–æ—Ç–æ –∑–æ–Ω—ã -->
                        <div class="text-center mb-3">
                            {{if .PhotoPath.Valid}}
                            <img src="/uploads/{{.PhotoPath.String}}" class="photo-preview img-thumbnail"
                                alt="–§–æ—Ç–æ {{.Name}}" data-bs-toggle="tooltip" data-bs-placement="top"
                                title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞">
                            {{else}}
                            <div class="no-photo-placeholder d-flex align-items-center justify-content-center"
                                data-bs-toggle="tooltip" data-bs-placement="top" title="–§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ">
                                <span class="text-muted">üì∑ –ù–µ—Ç —Ñ–æ—Ç–æ</span>
                            </div>
                            {{end}}
                        </div>

                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–æ–Ω–µ -->
                        <p class="card-text">{{.Description}}</p>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between">
                                <span>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:</span>
                                <span class="badge bg-primary">{{.Capacity}} —á–µ–ª.</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>–°—Ç–∞—Ç—É—Å:</span>
                                <span class="badge 
        {{if eq .Status " –î–æ—Å—Ç—É–ø–Ω–∞"}}bg-success {{else if eq .Status "–ù–∞ —Ä–µ–º–æ–Ω—Ç–µ" }}bg-warning {{else if eq
                                    .Status "–ó–∞–∫—Ä—ã—Ç–∞" }}bg-secondary {{else}}bg-danger{{end}}">
                                    {{.Status}}
                                </span>
                            </li>
                        </ul>
                    </div>
                    <div class="card-footer">
                        <div class="btn-group w-100">
                            <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ -->
                            <button class="btn btn-outline-success btn-sm" data-bs-toggle="modal"
                                data-bs-target="#uploadPhotoModal" data-zone-id="{{.ID}}" data-zone-name="{{.Name}}"
                                data-bs-toggle="tooltip" data-bs-placement="top" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –¥–ª—è —ç—Ç–æ–π –∑–æ–Ω—ã">
                                üì∑ –§–æ—Ç–æ
                            </button>

                            <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                            <button class="btn btn-outline-primary btn-sm" data-bs-toggle="tooltip"
                                data-bs-placement="top" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–æ–Ω–µ">
                                ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å
                            </button>

                            <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
                            <button class="btn btn-outline-danger btn-sm delete-zone-btn" data-zone-id="{{.ID}}"
                                data-zone-name="{{.Name}}" data-bs-toggle="tooltip" data-bs-placement="top"
                                title="–£–¥–∞–ª–∏—Ç—å –∑–æ–Ω—É">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {{else}}
            <div class="col-12">
                <div class="alert alert-info text-center">
                    <h5>üèüÔ∏è –ó–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h5>
                    <p>–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—É" —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–æ–Ω—É</p>
                </div>
            </div>
            {{end}}
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–æ–Ω—ã -->
    <div class="modal fade" id="addZoneModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—É</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addZoneForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–æ–Ω—ã *</label>
                            <input type="text" class="form-control" name="name" required
                                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞—Ä–¥–∏–æ-–∑–æ–Ω–∞">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea class="form-control" name="description" rows="3"
                                placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–æ–Ω—ã –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è..."></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å *</label>
                                    <input type="number" class="form-control" name="capacity" min="1" max="100"
                                        value="10" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                    <select class="form-select" name="status" required>
                                        <option value="–î–æ—Å—Ç—É–ø–Ω–∞" selected>–î–æ—Å—Ç—É–ø–Ω–∞</option>
                                        <option value="–ù–∞ —Ä–µ–º–æ–Ω—Ç–µ">–ù–∞ —Ä–µ–º–æ–Ω—Ç–µ</option>
                                        <option value="–ó–∞–∫—Ä—ã—Ç–∞">–ó–∞–∫—Ä—ã—Ç–∞</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ -->
    <div class="modal fade" id="uploadPhotoModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –∑–æ–Ω—ã</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="uploadPhotoForm" enctype="multipart/form-data">
                    <div class="modal-body">
                        <input type="hidden" id="uploadZoneId" name="zone_id">

                        <div class="mb-3">
                            <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ</label>
                            <input type="file" class="form-control" name="photo" accept="image/*" required>
                            <div class="form-text">
                                –†–∞–∑—Ä–µ—à–µ–Ω—ã: JPEG, PNG, GIF, WebP. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB
                            </div>
                        </div>

                        <div class="mb-3">
                            <label>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</label>
                            <div id="photoPreview" class="text-center mt-2">
                                <img id="previewImage" class="img-thumbnail d-none" style="max-height: 200px;">
                                <div id="noPreview" class="text-muted">
                                    üì∑ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-success">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-light mt-5 py-3">
        <div class="container text-center">
            <small>–§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä &copy; 2025</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è tooltips
        document.addEventListener('DOMContentLoaded', function () {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è –∑–æ–Ω
            document.querySelectorAll('.delete-zone-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const zoneId = this.getAttribute('data-zone-id');
                    const zoneName = this.getAttribute('data-zone-name');

                    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–æ–Ω—É "${zoneName}"?`)) {
                        deleteZone(zoneId, zoneName);
                    }
                });
            });
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–æ–Ω—ã
        document.getElementById('addZoneForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const submitBtn = this.querySelector('button[type="submit"]');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚åõ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';

            try {
                const response = await fetch('/zones', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    this.reset();

                    const modal = bootstrap.Modal.getInstance(document.getElementById('addZoneModal'));
                    modal.hide();

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                    setTimeout(() => location.reload(), 1000);
                } else {
                    alert('‚ùå ' + result.error);
                }

            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        document.getElementById('uploadPhotoModal').addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const zoneId = button.getAttribute('data-zone-id');
            const zoneName = button.getAttribute('data-zone-name');

            const modalTitle = this.querySelector('.modal-title');
            modalTitle.textContent = `–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ: ${zoneName}`;

            document.getElementById('uploadZoneId').value = zoneId;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
            document.getElementById('previewImage').classList.add('d-none');
            document.getElementById('noPreview').style.display = 'block';
            document.querySelector('input[name="photo"]').value = '';
        });

        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
        document.querySelector('input[name="photo"]').addEventListener('change', function (e) {
            const file = e.target.files[0];
            const preview = document.getElementById('previewImage');
            const noPreview = document.getElementById('noPreview');

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.classList.remove('d-none');
                    noPreview.style.display = 'none';
                }
                reader.readAsDataURL(file);
            } else {
                preview.classList.add('d-none');
                noPreview.style.display = 'block';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        document.getElementById('uploadPhotoForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const zoneId = document.getElementById('uploadZoneId').value;
            const formData = new FormData(this);
            const submitBtn = this.querySelector('button[type="submit"]');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚åõ –ó–∞–≥—Ä—É–∑–∫–∞...';

            try {
                const response = await fetch(`/zones/${zoneId}/upload-photo`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ ' + result.message);

                    const modal = bootstrap.Modal.getInstance(document.getElementById('uploadPhotoModal'));
                    modal.hide();

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                    setTimeout(() => location.reload(), 1000);
                } else {
                    alert('‚ùå ' + result.error);
                }

            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ';
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–æ–Ω—ã (–∑–∞–≥–ª—É—à–∫–∞)
        function deleteZone(zoneId, zoneName) {
            alert(`–§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∑–æ–Ω—ã "${zoneName}" (ID: ${zoneId}) –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ`);
            // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DELETE –∑–∞–ø—Ä–æ—Å –∫ API
   
        }

        // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ –ø—Ä–∏ –∫–ª–∏–∫–µ
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('photo-preview')) {
                const imgSrc = e.target.src;
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 9999;
                    cursor: zoom-out;
                `;

                const img = document.createElement('img');
                img.src = imgSrc;
                img.style.cssText = `
                    max-width: 90%;
                    max-height: 90%;
                    border-radius: 8px;
                    box-shadow: 0 0 30px rgba(0,0,0,0.5);
                `;

                overlay.appendChild(img);
                overlay.addEventListener('click', function () {
                    document.body.removeChild(overlay);
                });

                document.body.appendChild(overlay);
            }
        });
    </script>
</body>

</html>