<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">üèãÔ∏è –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="/">üìä –ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li class="nav-item"><a class="nav-link" href="/clients">üë• –ö–ª–∏–µ–Ω—Ç—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/trainers">üèÉ –¢—Ä–µ–Ω–µ—Ä—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/subscriptions">üé´ –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/trainings">üìÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a></li>
                    <li class="nav-item"><a class="nav-link" href="/zones">üèüÔ∏è –ó–æ–Ω—ã</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about">‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>üé´ {{.Title}}</h1>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSubscriptionModal">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç
            </button>
        </div>

        {{if .Message}}
        <div class="alert alert-info">
            <h5>{{.Message}}</h5>
            <p>–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ –≤ –ë–î –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç</p>
        </div>
        {{else}}
        <!-- –¢–∞–±–ª–∏—Ü–∞ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">–°–ø–∏—Å–æ–∫ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤</h5>
            </div>
            <div class="card-body">
                {{if .Subscriptions}}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                <th>–¢–∞—Ä–∏—Ñ</th>
                                <th>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</th>
                                <th>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–¶–µ–Ω–∞</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range .Subscriptions}}
                            <tr>
                                <td>{{.ID}}</td>
                                <td>{{.ClientName}}</td>
                                <td>{{.TariffName}}</td>
                                <td>{{.StartDate.Format "02.01.2006"}}</td>
                                <td>{{.EndDate.Format "02.01.2006"}}</td>
                                <td>
                                    <span class="badge 
                                            {{if eq .Status " –ê–∫—Ç–∏–≤–µ–Ω"}}bg-success {{else if eq .Status "–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
                                        }}bg-warning {{else}}bg-secondary{{end}}">
                                        {{.Status}}
                                    </span>
                                </td>
                                <td>{{.Price}} ‚ÇΩ</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å">
                                        üóëÔ∏è
                                    </button>
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
                {{else}}
                <div class="alert alert-info">
                    <h5>–ê–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h5>
                    <p>–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç" —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç</p>
                </div>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞ -->
    <div class="modal fade" id="addSubscriptionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addSubscriptionForm">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">–ö–ª–∏–µ–Ω—Ç *</label>
                                    <select class="form-select" name="client_id" id="clientSelect" required>
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">–¢–∞—Ä–∏—Ñ *</label>
                                    <select class="form-select" name="tariff_id" id="tariffSelect" required>
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ...</option>
                                        <option value="1">–ë–∞–∑–æ–≤—ã–π (2000 ‚ÇΩ)</option>
                                        <option value="2">–ü—Ä–µ–º–∏—É–º (5000 ‚ÇΩ)</option>
                                        <option value="3">–í–ò–ü (10000 ‚ÇΩ)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ *</label>
                                    <input type="date" class="form-control" name="start_date" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è *</label>
                                    <input type="date" class="form-control" name="end_date" required>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                            <select class="form-select" name="status">
                                <option value="–ê–∫—Ç–∏–≤–µ–Ω" selected>–ê–∫—Ç–∏–≤–µ–Ω</option>
                                <option value="–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω">–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</option>
                                <option value="–ó–∞–≤–µ—Ä—à–µ–Ω">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-light mt-5 py-3">
        <div class="container text-center">
            <small>–§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä &copy; 2025</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è ComboBox –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.getElementById('addSubscriptionModal').addEventListener('show.bs.modal', async function () {
            await loadClientsForSelect();
        });

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ ComboBox
        async function loadClientsForSelect() {
            try {
                const response = await fetch('/api/clients-for-select');
                const result = await response.json();

                const select = document.getElementById('clientSelect');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞...</option>';

                if (result.success) {
                    result.clients.forEach(client => {
                        const option = document.createElement('option');
                        option.value = client.id;
                        option.textContent = client.name;
                        select.appendChild(option);
                    });
                } else {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:', result.error);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞
        document.getElementById('addSubscriptionForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const clientName = document.getElementById('clientSelect').selectedOptions[0]?.textContent;
            const tariffName = document.getElementById('tariffSelect').selectedOptions[0]?.textContent;

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modal = bootstrap.Modal.getInstance(document.getElementById('addSubscriptionModal'));
            modal.hide();

            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            this.reset();
        });
    </script>
</body>

</html>